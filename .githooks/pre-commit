#!/usr/bin/env bash
# File generated by prek: https://github.com/j178/prek
# ID: 182c10f181da4464a3eec51b83331688

# Save GIT_DIR and GIT_WORK_TREE for bare repository support before unsetting.
# See: https://github.com/j178/prek/issues/1239
PREK_SAVED_GIT_DIR="$GIT_DIR"
PREK_SAVED_GIT_WORK_TREE="$GIT_WORK_TREE"

# Unset GIT_DIR to avoid git taking current directory as the git dir.
# See:
# https://github.com/pre-commit/pre-commit/issues/2295
# https://www.spinics.net/lists/git/msg374197.html
unset GIT_DIR

ARGS=(hook-impl --hook-type=pre-commit --skip-on-missing-config --script-version=3)

# Detect quiet mode and forward to prek
if [ -n "$GIT_QUIET" ]; then
    ARGS+=(--quiet)
fi

# Pass saved GIT_DIR and GIT_WORK_TREE if they were set
if [ -n "$PREK_SAVED_GIT_DIR" ]; then
    ARGS+=(--git-dir "$PREK_SAVED_GIT_DIR")
fi
if [ -n "$PREK_SAVED_GIT_WORK_TREE" ]; then
    ARGS+=(--work-tree "$PREK_SAVED_GIT_WORK_TREE")
fi

HERE="$(cd "$(dirname "$0")" && pwd)"
ARGS+=(--hook-dir "$HERE" -- "$@")
PREK="/usr/bin/prek"

# Check if the full path to prek is executable, otherwise fallback to PATH
if [ ! -x "$PREK" ]; then
    PREK="prek"
fi

exec "$PREK" "${ARGS[@]}"

